/*! 
* Mediator.js Library v0.5.0
* https://github.com/ajacksified/Mediator.js
*
* Copyright 2011, Jack Lawson
* MIT Licensed (http://www.opensource.org/licenses/mit-license.php)
*
* For more information: http://www.thejacklawson.com/index.php/2011/06/mediators-for-modularized-asynchronous-programming-in-javascript/
* Project on GitHub: https://github.com/ajacksified/Mediator.js
*
* Last update: Sep 15 2011
*/

(function(){function h(){var a=function(){return((1+Math.random())*65536|0).toString(16).substring(1)};return a()+a()+"-"+a()+"-"+a()+"-"+a()+"-"+a()+a()+a()}function g(a,b,c){if(!this instanceof g)return new g(a,c,b);else this.id=h(),this.fn=a,this.options=b,this.context=c}function e(){if(!this instanceof e)return new e;else this._callbacks=[],this._channels=[]}function f(){if(!this instanceof f)return new f;else this._channels=new e}g.prototype={Update:function(a){if(a)this.fn=a.fn||this.fn,this.context=
a.context||this.context,this.options=a.options||this.options}};e.prototype={AddSubscriber:function(a,b,c){a=new g(a,b,c);if(b&&b.priority!==void 0){b.priority>>=0;if(b.priority<0)b.priority=0;if(b.priority>this._callbacks.length)b.priority=this._callbacks.length;this._callbacks.splice(b.priority,1,a)}else this._callbacks.push(a);return a},GetSubscriber:function(a){for(var b=0,c=this._callbacks.length;b<c;b++)if(this._callbacks[b].id==a||this._callbacks[b].fn==a)return this._callbacks[b];for(var d in this._channels)if(this._channels.hasOwnProperty(d)&&
(b=this._channels[d].GetSubscriber(a),b!==void 0))return b},SetPriority:function(a,b){for(var c=0,d=0,e=this._callbacks.length;d<e;d++){if(this._callbacks[d].id==a||this._callbacks[d].fn==a)break;c++}d=this._callbacks[c];e=this._callbacks.slice(0,c);c=this._callbacks.slice(c+1,this._callbacks.length-c);this._callbacks=e.concat(c);this._callbacks.splice(b,0,d)},AddChannel:function(a){this._channels[a]=new e},HasChannel:function(a){return this._channels.hasOwnProperty(a)},ReturnChannel:function(a){return this._channels[a]},
RemoveSubscriber:function(a){if(!a){this._callbacks=[];for(var b in this._channels)this._channels.hasOwnProperty(b)&&this._channels[b].RemoveSubscriber(a)}b=0;for(var c=this._callbacks.length;b<c;b++)if(this._callbacks[b].fn==a||this._callbacks[b].id==a)this._callbacks.splice(b,1),c--,b--},Publish:function(a){for(var b=0,c=this._callbacks.length;b<c;b++){var d=this._callbacks[b];d.options!==void 0&&typeof d.options.predicate==="function"?d.options.predicate.apply(d.context,a)&&d.fn.apply(d.context,
a):d.fn.apply(d.context,a)}for(c in this._channels)this._channels.hasOwnProperty(c)&&this._channels[c].Publish(a)}};f.prototype={GetChannel:function(a){var b=this._channels,c=a.split(":");if(a==="")return b;if(c.length>0)for(var a=0,d=c.length;a<d;a++)b.HasChannel(c[a])||b.AddChannel(c[a]),b=b.ReturnChannel(c[a]);return b},Subscribe:function(a,b,c,d){c=c||{};d=d||{};return this.GetChannel(a).AddSubscriber(b,c,d)},GetSubscriber:function(a,b){return this.GetChannel(b||"").GetSubscriber(a)},Remove:function(a,
b){this.GetChannel(a).RemoveSubscriber(b)},Publish:function(a){this.GetChannel(a).Publish(Array.prototype.slice.call(arguments,1))}};window.Mediator=f;f.Channel=e;f.Subscriber=g})(window);
